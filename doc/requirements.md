# app024: キャラプロンプト辞書 - 要件定義書

## 1. アプリ概要
キャラクター設定（外見・口調・背景）をカード形式で管理し、ワンクリックでプロンプトに差し込めるツール。創作チームでの設定破綻を防止し、AI画像生成やストーリー創作を効率化。

## 2. 目的・課題

### 解決する課題
- 複数キャラクターの設定管理が煩雑
- AI画像生成時に毎回同じプロンプトを入力するのが手間
- チーム創作時にキャラ設定の認識がズレる
- 過去に作ったキャラ設定を忘れる・見失う
- プロンプトのバージョン管理が難しい

### 目的
- キャラクター設定を一元管理
- ワンクリックでプロンプトをクリップボードにコピー
- チーム間でのキャラ設定共有
- 設定の一貫性維持と破綻防止

## 3. ターゲットユーザー
- 小説家・ライター
- 漫画家・イラストレーター
- AI画像生成ユーザー
- TRPG・創作ゲームプレイヤー
- チームで創作活動を行うクリエイター

## 4. 機能要件

### 4.1 必須機能（MVP）
- **キャラクターカード作成**
  - キャラクター名
  - 外見設定（髪型、目の色、身長、服装等）
  - 口調・性格
  - 背景・設定
  - タグ（作品名、種族、役割等）

- **プロンプト生成**
  - 各カードから自動的にプロンプト文字列を生成
  - 画像生成用プロンプト（外見重視）
  - 文章生成用プロンプト（性格・口調重視）
  - カスタムテンプレート対応

- **ワンクリックコピー**
  - プロンプトをクリップボードにコピー
  - コピー完了の視覚的フィードバック

- **カード一覧表示**
  - グリッドビューで全キャラを表示
  - サムネイル画像対応（任意）
  - タグによる絞り込み

- **検索・フィルター**
  - キャラ名検索
  - タグフィルター
  - 作品別フィルター

### 4.2 拡張機能（優先度：中）
- **テンプレート機能**
  - プロンプトテンプレートのカスタマイズ
  - 複数テンプレートの切り替え
  - 変数埋め込み（`{{name}}`, `{{appearance}}`等）

- **バージョン管理**
  - キャラ設定の履歴保存
  - 過去バージョンへの復元

- **エクスポート/インポート**
  - JSON形式でキャラデータを書き出し
  - 他ユーザーとの設定共有
  - バッチインポート

- **サムネイル管理**
  - キャラごとにサムネイル画像を設定
  - 画像アップロード機能

### 4.3 PWA機能（優先度：中）
- **Progressive Web App化**
  - ホーム画面への追加
  - オフライン対応（Service Worker）
  - アプリライクな起動体験
  - キャッシュ戦略によるパフォーマンス向上
  - プッシュ通知（将来的に）

### 4.4 将来的な拡張（優先度：低）
- 関係性マップ（キャラ間の相関図）
- プロンプト履歴・使用統計
- チーム共同編集機能（リアルタイム同期）

### 4.5 AI機能（Gemini API）
- **キャラクター設定自動補完**
  - キャラ名や簡単な設定（例: 「元気な女子高生」）を入力
  - Gemini APIが詳細な外見・性格・背景を自動生成
  - ユーザーが編集・調整可能

- **プロンプト最適化**
  - 日本語のキャラ設定を英語プロンプトに自動変換
  - AI画像生成に最適化された表現に変換
  - 画像生成AIごとの最適化（Stable Diffusion/DALL-E等の特性に合わせる）

- **キャラクター画像生成（Imagen 3）**
  - 設定したキャラ情報からImagen 3で画像を直接生成
  - 生成された画像をサムネイルとして自動設定
  - 複数バリエーションの生成・選択

- **設定の一貫性チェック**
  - キャラクター設定の矛盾を検出
  - 論理的な整合性をチェック
  - 改善提案

- **関連キャラの提案**
  - 既存キャラに基づいて関連キャラのアイデアを提案
  - 「このキャラの親友」「ライバル」等の設定案

## 5. 非機能要件

### 5.1 パフォーマンス
- 100キャラクターまでスムーズに管理
- カード表示のレスポンス < 100ms
- 検索結果の即時表示

### 5.2 ユーザビリティ
- 直感的なカードUI
- フォーム入力の簡潔さ
- キーボードショートカット対応（Ctrl+C等）

### 5.3 データ管理
- LocalStorageでデータ永続化
- JSONエクスポートでバックアップ
- データ破損時の復旧機能

## 6. 技術制約

### 6.1 環境要件
- モダンブラウザ対応
- レスポンシブデザイン（デスクトップ・タブレット）
- オフライン動作可能

### 6.2 データ制約
- LocalStorage容量制限を考慮
- 画像はBase64またはURL保存
- 1キャラ当たりのデータサイズ < 50KB

### 6.3 セキュリティ
- XSS対策（入力データのサニタイズ）
- ローカル保存のみ（外部送信なし）

### 6.4 AI API仕様
- **使用API**: Google Gemini API
  - テキスト生成: gemini-2.0-flash-exp
  - 画像生成: Imagen 3（Google AI Studio API経由）
  - エンドポイント: Google AI Studio API

- **APIキー管理**
  - 保存場所: LocalStorage
  - 保存形式: 平文（暗号化なし）
  - キー名: `gemini_api_key`
  - 設定UI: アプリ内設定画面で登録・変更可能

- **起動時チェック**
  - APIキー未登録時は設定画面を表示
  - APIキー検証（簡易的な接続テスト）
  - エラーハンドリング（APIキー無効時の対応）

- **AI機能の利用**
  - AI機能はオプション（APIキーなしでも基本機能は利用可能）
  - API呼び出しエラー時の適切なフィードバック
  - レート制限への対応
  - 画像生成の待ち時間表示（進行状況インジケーター）

### 6.5 Gemini API モデル一覧と無料枠（2025年10月時点）

#### テキスト生成モデル

| モデル名 | 無料枠 | RPM | RPD | 料金（無料枠外） | 備考 |
|---------|--------|-----|-----|----------------|------|
| gemini-2.0-flash-exp | ✅ あり | 10 | 1,000 | $0/M | **本アプリで使用** |
| gemini-2.0-flash | ✅ あり | 15 | 200 | 入力$0.10/M、出力$0.40/M | 以前は1,500 RPD |
| gemini-2.5-flash | ✅ あり | 10 | 250 | 入力$0.30/M、出力$30/M | 250,000 TPM |
| gemini-2.5-pro | ⚠️ 制限あり | 2 | 50 | 入力$0.30/M、出力$30/M | 無料提供停止の報告あり |

#### 画像生成モデル

| モデル名 | 無料枠 | RPM | RPD | 料金 | 備考 |
|---------|--------|-----|-----|------|------|
| **Imagen 3** | ❌ なし | - | - | **課金必須** | **本アプリで使用予定** |
| Imagen 4 (imagen-4.0-generate-001) | ⚠️ 限定テスト | - | - | $0.04/画像 | Google AI Studioで限定テスト可 |
| gemini-2.5-flash-image-preview | ✅ あり | 5 | 25 | $0.039/画像 | 無料枠で画像生成可能 |

#### 動画生成モデル

| モデル名 | 無料枠 | 料金 | 備考 |
|---------|--------|------|------|
| Veo 3 | ❌ なし | $0.15/秒 | 動画+音声 (720p, 1080p) |
| Veo 3 Fast | ❌ なし | $0.10/秒 | 動画のみ (720p, 1080p) |
| Veo 2 | ❌ なし | $0.50/秒 | 動画のみ (720p) |

**注意事項**:
- RPM: Requests Per Minute（1分あたりのリクエスト数）
- RPD: Requests Per Day（1日あたりのリクエスト数）
- TPM: Tokens Per Minute（1分あたりのトークン数）
- M: Million（100万トークン）
- 無料枠を超えた場合、GCP Billingが有効な場合のみ課金される
- GCP Billing未設定の場合は、無料枠超過時にAPI利用が制限される

### 6.6 本アプリでの課金に関する重要事項

#### テキスト生成機能（キャラ設定補完、プロンプト最適化）
- **無料枠**: 1日1,000回まで（10 RPM）
- **超過時**: GCP Billing未設定なら利用制限、設定済みなら従量課金
- **ユーザー負担**: APIキー登録者

#### 画像生成機能（Imagen 3）
- **無料枠**: ❌ なし（課金必須）
- **必要条件**: GCP Billing有効化必須
- **料金**: 使用量に応じた従量課金
- **ユーザー負担**: APIキー登録者（$300トライアルクレジットから消費）
- **UI表示**: 「⚠️ この機能は課金対象です（無料枠なし）」と明示

#### 代替案（画像生成を無料枠内で利用する場合）
- **gemini-2.5-flash-image-preview**: 無料枠あり（5 RPM、25 RPD）
- より制限が厳しいが、完全無料で画像生成可能
- ユーザーが選択できるようにする選択肢として検討可能

## 7. 成功基準

### 7.1 機能面
- ✅ キャラカードの作成・編集・削除ができる
- ✅ プロンプトをワンクリックでコピーできる
- ✅ タグ・検索で目的のキャラを素早く見つけられる
- ✅ データのエクスポート/インポートが正常動作

### 7.2 UX面
- ✅ 新規キャラ作成が3分以内に完了
- ✅ プロンプトコピーが1クリックで完結
- ✅ 初見で操作方法が理解できる

### 7.3 技術面
- ✅ 100キャラでも動作が軽快
- ✅ データ損失なく永続化
- ✅ クリップボードAPIが正常動作

## 8. 制約事項・前提条件

### 8.1 制約事項
- 画像編集機能は含まない
- リアルタイム共同編集は未対応（Phase 1）
- AI自動生成機能は未搭載（Phase 1）

### 8.2 前提条件
- ユーザーはキャラクター設定を自分で入力
- Clipboard API対応ブラウザ
- JavaScript有効環境

## 9. UI/UX要求

### 9.1 デザイン方向性
- カード型UIでビジュアル重視
- 創作意欲を高めるカラフルなデザイン
- タグは色分けで視認性向上

### 9.2 主要画面
1. **ダッシュボード**（カード一覧）
   - ヘッダー: アプリ名、新規作成ボタン、検索バー
   - フィルターエリア: タグ選択、作品選択
   - メインエリア: キャラカードのグリッド表示（3〜4列）
   - 各カード: サムネイル、名前、主要タグ、コピーボタン

2. **キャラクター作成/編集画面**
   - フォーム形式
   - 入力項目:
     - キャラ名（必須）
     - 外見（テキストエリア）
     - 性格・口調（テキストエリア）
     - 背景・設定（テキストエリア）
     - タグ（複数入力可、オートコンプリート）
     - サムネイル画像（任意）
   - プレビューエリア: 生成されるプロンプトをリアルタイム表示
   - 保存/キャンセルボタン

3. **プロンプトプレビューモーダル**
   - 生成されたプロンプト全文を表示
   - コピーボタン
   - テンプレート切り替え（画像用/文章用）
   - 編集ボタン（カスタマイズ）

## 10. スケジュール・優先度

### Phase 1（MVP）
- キャラカード作成・編集・削除
- プロンプト生成・コピー
- タグ管理・検索
- データ永続化

### Phase 2（拡張）
- テンプレート機能
- サムネイル管理
- エクスポート/インポート

### Phase 3（改善）
- バージョン管理
- UI/UXブラッシュアップ
- パフォーマンス最適化

## 11. データ構造（初期案）

```json
{
  "characters": [
    {
      "id": "char_001",
      "name": "山田太郎",
      "appearance": "黒髪ショート、茶色の瞳、身長170cm、学生服",
      "personality": "明るく前向き、少し天然、語尾に「〜だね」を付ける",
      "background": "高校2年生、サッカー部所属、主人公の親友",
      "tags": ["ファンタジー小説A", "男性", "サブキャラ"],
      "thumbnail": "data:image/png;base64,...",
      "createdAt": "2025-01-01T00:00:00Z",
      "updatedAt": "2025-01-10T12:00:00Z"
    }
  ]
}
```

## 12. プロンプトテンプレート例

### 画像生成用
```
{{name}}, {{appearance}}, {{tags}}
```

### 文章生成用
```
キャラクター名: {{name}}
性格: {{personality}}
口調: {{speech_pattern}}
背景: {{background}}
```

### カスタマイズ例（詳細版）
```
Name: {{name}}
Appearance: {{appearance}}
Personality: {{personality}}
Background: {{background}}
Tags: {{tags}}
```
